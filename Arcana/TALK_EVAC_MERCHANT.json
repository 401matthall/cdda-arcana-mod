[
  {
    "id": "TALK_EVAC_MERCHANT",
    "type": "talk_topic",
    "responses": [
      {
        "text": "Do you know of any other settlements in the region?",
        "topic": "TALK_EVAC_MERCHANT_CF",
        "effect": [
          { "npc_add_effect": "rural_church_aware", "duration": "PERMANENT" },
          { "u_add_effect": "rural_church_aware", "duration": "PERMANENT" },
          {
            "mapgen_update": "arcana_dummy",
            "om_terrain": "cf_church_4",
            "om_special": "cf_rural_church",
            "om_terrain_replace": "field",
            "random": true,
            "reveal_radius": 3
          }
        ],
        "condition": { "not": { "npc_has_effect": "rural_church_aware" } }
      },
      {
        "text": "Do you know of any other settlements in the region?",
        "topic": "TALK_EVAC_MERCHANT_CF",
        "effect": [
          { "u_add_effect": "rural_church_aware", "duration": "PERMANENT" },
          {
            "mapgen_update": "arcana_dummy",
            "om_terrain": "cf_church_4",
            "om_special": "cf_rural_church",
            "reveal_radius": 3
          }
        ],
        "condition": { "and": [ { "not": { "u_has_effect": "rural_church_aware" } }, { "npc_has_effect": "rural_church_aware" } ] }
      },
      {
        "text": "[MISSION] Sofia sent me with the latest inventory for trading.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION",
        "condition": {
          "and": [
            { "u_has_item": "cf_rep_trade_arrangement" },
            { "u_has_mission": "MISSION_CF_REP_2" },
            { "not": { "npc_has_effect": "cf_mission_receipt" } }
          ]
        }
      },
      {
        "text": "[MISSION] Can you print another copy of the receipt?",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_RECEIPT",
        "condition": {
          "and": [
            { "not": { "u_has_item": "cf_rep_trade_receipt" } },
            { "u_has_mission": "MISSION_CF_REP_2" },
            { "npc_has_effect": "cf_mission_receipt" }
          ]
        }
      }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF",
    "type": "talk_topic",
    "dynamic_line": "Not many holdouts large enough to call a settlement, but there is activity out there at least.  We have our own work on getting something set up.  There's also a small group that occasionally sends traders to visit us, seems they're holed up in some old church off the roadside.  I'll go ahead and tell you roughly where it is.",
    "responses": [ { "text": "Thank you.", "topic": "TALK_EVAC_MERCHANT" } ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION",
    "type": "talk_topic",
    "dynamic_line": {
      "u_has_effect": "rural_church_aware",
      "yes": "Interesting to see they hired you to help out.  Well then, hope they informed you of the details.  Payment's in advance, half a kilo of gold.  Nowhere near as valuable these days, but it's not completely useless, and some groups have been using it informally for barter.",
      "no": "Huh, usually Sofia's the one to deliver their invoice.  Alright, hopefully she told you how this works.  Payment's in advance, preferably half a kilo of gold.  Nowhere near as valuable these days, but it's not completely useless, and some groups have been using it informally for barter."
    },
    "responses": [
      {
        "text": "Here you go!",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "u_has_items": { "item": "gold_small", "count": 100 } },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_sell_item": "gold_small", "count": 100 } ]
      },
      {
        "text": "How about 250 grams?",
        "condition": { "u_has_items": { "item": "gold_small", "count": 50 } },
        "trial": { "type": "PERSUADE", "difficulty": 10 },
        "success": { "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL", "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_sell_item": "gold_small", "count": 50 } ] },
        "failure": { "opinion": { "value": -1 }, "topic": "TALK_EVAC_MERCHANT_CF_MISSION_NODEAL" }
      },
      {
        "text": "Would silver suffice?",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_SILVER",
        "condition": { "u_has_item": "silver_small" }
      },
      { "text": "What about cash?", "topic": "TALK_EVAC_MERCHANT_CF_MISSION_CASH" },
      {
        "text": "I don't have enough on hand on the moment.  I'll deal with this later.",
        "topic": "TALK_EVAC_MERCHANT",
        "condition": { "not": { "u_has_items": { "item": "gold_small", "count": 100 } } }
      },
      { "text": "I'll deal with this later.", "topic": "TALK_EVAC_MERCHANT" }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_SILVER",
    "type": "talk_topic",
    "dynamic_line": "They've offered that on occasion too, but they usually send.  Will need more, closer to a kilogram.  I'll go as low as 900 grams.  Not as many practical uses for silver since it can tarnish, but it works decently for a few things.",
    "responses": [
      {
        "text": "Here you go!",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "u_has_items": { "item": "silver_small", "count": 300 } },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_sell_item": "silver_small", "count": 300 } ]
      },
      {
        "text": "On second thought, I'll pay in gold.  Here you go.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": {
          "and": [
            { "u_has_items": { "item": "silver_small", "count": 300 } },
            { "u_has_items": { "item": "gold_small", "count": 100 } }
          ]
        },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_sell_item": "gold_small", "count": 100 } ]
      },
      {
        "text": "I don't have enough silver, so I'll pay via the normal method.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": {
          "and": [
            { "not": { "u_has_items": { "item": "silver_small", "count": 300 } } },
            { "u_has_items": { "item": "gold_small", "count": 100 } }
          ]
        },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_sell_item": "gold_small", "count": 100 } ]
      },
      { "text": "Nevermind.  I'll deal with it later.", "topic": "TALK_EVAC_MERCHANT" }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_CASH",
    "type": "talk_topic",
    "dynamic_line": "If you have it in your account sure.  I've accepted that group's offers mostly since they've been reliable customers and are far enough out that dealing with cash cards isn't as practical as barter.  I've been honoring their barter offer at about half what the gold would be worth back in the day.  Payment's $250 electronically.",
    "responses": [
      {
        "text": "[$250] You have a deal.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "u_has_cash": 25000 },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_spend_cash": 25000 } ]
      },
      {
        "text": "On second thought, I'll pay in gold.  Here you go.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "and": [ { "u_has_cash": 25000 }, { "u_has_items": { "item": "gold_small", "count": 100 } } ] },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_sell_item": "gold_small", "count": 100 } ]
      },
      {
        "text": "I don't have enough in my account, so I'll pay in gold.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "and": [ { "not": { "u_has_cash": 25000 } }, { "u_has_items": { "item": "gold_small", "count": 100 } } ] },
        "effect": [ { "u_consume_item": "cf_rep_trade_arrangement" }, { "u_sell_item": "gold_small", "count": 100 } ]
      },
      { "text": "Nevermind.  I'll deal with it later.", "topic": "TALK_EVAC_MERCHANT" }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
    "type": "talk_topic",
    "dynamic_line": "Pleasure doing business with you.  I'll have my men set up the next caravan with the usual instructions and put together their inventory based on Sofia's recommendations.  Let me print up the receipt.",
    "responses": [
      {
        "text": "Thank you.",
        "topic": "TALK_EVAC_MERCHANT",
        "effect": [
          { "npc_add_effect": "cf_mission_receipt", "duration": "PERMANENT" },
          { "u_add_effect": "cf_mission_receipt", "duration": "PERMANENT" },
          { "u_buy_item": "cf_rep_trade_receipt" }
        ]
      }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_NODEAL",
    "type": "talk_topic",
    "dynamic_line": "Sorry, 500 grams is as low as I can go.  Gold's not as handy now that the world's ended. I'm already honoring half its old, pre-apocalypse value.",
    "responses": [
      {
        "text": "Okay, here you go.",
        "topic": "TALK_EVAC_MERCHANT_CF_MISSION_DEAL",
        "condition": { "u_has_items": { "item": "gold_small", "count": 100 } },
        "effect": { "u_sell_item": "gold_small", "count": 100 }
      },
      { "text": "Nevermind then.", "topic": "TALK_EVAC_MERCHANT" }
    ]
  },
  {
    "id": "TALK_EVAC_MERCHANT_CF_MISSION_RECEIPT",
    "type": "talk_topic",
    "dynamic_line": "Alright.  Try not to lose this one.",
    "responses": [ { "text": "Thanks!", "topic": "TALK_EVAC_MERCHANT", "effect": { "u_buy_item": "cf_rep_trade_receipt" } } ]
  }
]
